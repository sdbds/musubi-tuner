"""
Inline Kandinsky 5 task configs (no external YAML required).

TASK_CONFIGS keys match `--task`.
Each config stores model/vae/text/attention and sampling defaults.
"""

from __future__ import annotations

from dataclasses import dataclass
from typing import Dict, List, Optional


@dataclass
class TextEmbedderConfig:
    qwen_checkpoint: str
    qwen_max_length: int
    clip_checkpoint: str
    clip_max_length: int
    qwen_dim: int = 3584
    clip_dim: int = 768


@dataclass
class AttentionConfig:
    type: str
    chunk: bool
    causal: bool
    local: bool
    glob: bool
    window: int
    chunk_len: Optional[int] = None
    method: Optional[str] = None
    P: Optional[float] = None
    add_sta: Optional[bool] = None
    wT: Optional[int] = None
    wH: Optional[int] = None
    wW: Optional[int] = None


@dataclass
class VAEConfig:
    name: str
    checkpoint_path: str


@dataclass
class DiTParams:
    in_visual_dim: int
    out_visual_dim: int
    in_text_dim: int
    in_text_dim2: int
    time_dim: int
    patch_size: tuple[int, int, int]
    model_dim: int
    ff_dim: int
    num_text_blocks: int
    num_visual_blocks: int
    axes_dims: tuple[int, int, int]
    visual_cond: bool
    instruct_type: Optional[str] = None


@dataclass
class TaskConfig:
    name: str
    checkpoint_path: str
    num_steps: int
    guidance_weight: float
    resolution: int
    scale_factor: List[float]
    dit_params: DiTParams
    attention: AttentionConfig
    vae: VAEConfig
    text: TextEmbedderConfig
    scheduler_scale: Optional[float] = None
    magcache: Optional[List[float]] = None


def _text_default() -> TextEmbedderConfig:
    return TextEmbedderConfig(
        qwen_checkpoint="./weights/text_encoder/",
        qwen_max_length=256,
        clip_checkpoint="./weights/text_encoder2/",
        clip_max_length=77,
    )


def _text_image() -> TextEmbedderConfig:
    """Text embedder config for image models (t2i, i2i) with longer context."""
    return TextEmbedderConfig(
        qwen_checkpoint="./weights/text_encoder/",
        qwen_max_length=512,
        clip_checkpoint="./weights/text_encoder2/",
        clip_max_length=77,
    )


def _vae_hunyuan() -> VAEConfig:
    return VAEConfig(name="hunyuan", checkpoint_path="./weights/vae/")


TASK_CONFIGS: Dict[str, TaskConfig] = {
    # Lite image models
    "k5-lite-t2i-hd": TaskConfig(
        name="k5-lite-t2i-hd",
        checkpoint_path="./weights/model/kandinsky5lite_t2i.safetensors",
        num_steps=50,
        guidance_weight=3.5,
        resolution=1024,
        scale_factor=[1.0, 1.0, 1.0],
        dit_params=DiTParams(
            in_visual_dim=16,
            out_visual_dim=16,
            in_text_dim=3584,
            in_text_dim2=768,
            time_dim=512,
            patch_size=(1, 2, 2),
            model_dim=2560,
            ff_dim=10240,
            num_text_blocks=2,
            num_visual_blocks=50,
            axes_dims=(32, 48, 48),
            visual_cond=False,
        ),
        attention=AttentionConfig(type="flash", chunk=False, causal=False, local=False, glob=False, window=3),
        vae=VAEConfig(name="flux", checkpoint_path="./weights/flux/vae"),
        text=_text_image(),
        scheduler_scale=3.0,
        magcache=[
            0.83479,
            0.82401,
            1.04218,
            1.04684,
            1.03432,
            1.03566,
            1.02943,
            1.03087,
            1.02626,
            1.02726,
            1.01373,
            1.01395,
            1.01837,
            1.01873,
            1.01712,
            1.01791,
            1.01327,
            1.01376,
            1.01112,
            1.01102,
            1.01204,
            1.01224,
            1.00652,
            1.0078,
            1.01196,
            1.01195,
            1.00934,
            1.00964,
            1.0069,
            1.00723,
            1.00831,
            1.00917,
            1.00588,
            1.00604,
            1.00568,
            1.0066,
            1.00988,
            1.01066,
            1.00858,
            1.00936,
            1.00474,
            1.00465,
            1.00343,
            1.0047,
            1.0002,
            0.99511,
            1.00565,
            1.01499,
            1.00461,
            1.00507,
            1.00524,
            1.00542,
            1.00464,
            1.00471,
            0.99872,
            0.99837,
            1.00761,
            1.00841,
            1.00167,
            1.00196,
            1.00581,
            1.00603,
            1.00226,
            1.003,
            1.00387,
            1.00391,
            1.00357,
            1.00408,
            1.0014,
            1.00164,
            0.99996,
            1.00029,
            1.0055,
            1.00601,
            0.99761,
            0.99761,
            1.00028,
            1.00061,
            1.00353,
            1.0035,
            1.00035,
            1.00058,
            1.00196,
            1.00229,
            0.99987,
            1.00022,
            1.00144,
            1.00165,
            0.99946,
            0.99941,
            0.99732,
            0.99749,
            0.99646,
            0.99507,
            0.99323,
            0.99088,
            1.00579,
            0.99927,
        ],
    ),
    "k5-lite-i2i-hd": TaskConfig(
        name="k5-lite-i2i-hd",
        checkpoint_path="./weights/model/kandinsky5lite_i2i.safetensors",
        num_steps=50,
        guidance_weight=3.5,
        resolution=1024,
        scale_factor=[1.0, 1.0, 1.0],
        dit_params=DiTParams(
            in_visual_dim=16,
            out_visual_dim=16,
            in_text_dim=3584,
            in_text_dim2=768,
            time_dim=512,
            patch_size=(1, 2, 2),
            model_dim=2560,
            ff_dim=10240,
            num_text_blocks=2,
            num_visual_blocks=50,
            axes_dims=(32, 48, 48),
            visual_cond=False,
            instruct_type="channel",
        ),
        attention=AttentionConfig(type="flash", chunk=False, causal=False, local=False, glob=False, window=3),
        vae=VAEConfig(name="flux", checkpoint_path="./weights/flux/vae"),
        text=_text_image(),
        scheduler_scale=3.0,
    ),
    # Lite video models
    "k5-lite-t2v-5s-sd": TaskConfig(
        name="k5-lite-t2v-5s-sd",
        checkpoint_path="./weights/model/kandinsky5lite_t2v_sft_5s.safetensors",
        num_steps=50,
        guidance_weight=5.0,
        resolution=512,
        scale_factor=[1.0, 2.0, 2.0],
        dit_params=DiTParams(
            in_visual_dim=16,
            out_visual_dim=16,
            in_text_dim=3584,
            in_text_dim2=768,
            time_dim=512,
            patch_size=(1, 2, 2),
            model_dim=1792,
            ff_dim=7168,
            num_text_blocks=2,
            num_visual_blocks=32,
            axes_dims=(16, 24, 24),
            visual_cond=True,
        ),
        attention=AttentionConfig(type="flash", chunk=False, causal=False, local=False, glob=False, window=3),
        vae=_vae_hunyuan(),
        text=_text_default(),
        scheduler_scale=10.0,
        magcache=[
            0.91607,
            0.91507,
            0.95254,
            0.95349,
            1.04876,
            1.04937,
            1.0842,
            1.084,
            1.04372,
            1.04445,
            1.03521,
            1.03559,
            1.03906,
            1.03904,
            1.03104,
            1.03132,
            1.03618,
            1.03671,
            1.02519,
            1.02512,
            1.02595,
            1.02603,
            1.02378,
            1.02447,
            1.02427,
            1.02514,
            1.01967,
            1.01996,
            1.02266,
            1.02269,
            1.01885,
            1.01951,
            1.01913,
            1.01977,
            1.01944,
            1.02018,
            1.01664,
            1.01707,
            1.01682,
            1.01723,
            1.0155,
            1.01611,
            1.01998,
            1.02022,
            1.01194,
            1.01244,
            1.01626,
            1.01555,
            1.01611,
            1.01654,
            1.01545,
            1.01579,
            1.01362,
            1.01376,
            1.01589,
            1.01627,
            1.01527,
            1.01521,
            1.01301,
            1.01334,
            1.01415,
            1.01444,
            1.0144,
            1.01464,
            1.01444,
            1.01442,
            1.01361,
            1.01399,
            1.01397,
            1.01408,
            1.01412,
            1.01432,
            1.01453,
            1.01454,
            1.01341,
            1.01342,
            1.01317,
            1.01342,
            1.01018,
            1.01051,
            1.01278,
            1.0128,
            1.01021,
            1.01037,
            1.00809,
            1.00794,
            1.00679,
            1.00711,
            0.99882,
            0.99948,
            0.98905,
            0.98905,
            0.9755,
            0.97545,
            0.93786,
            0.93738,
            0.84336,
            0.84193,
        ],
    ),
    "k5-lite-t2v-10s-sd": TaskConfig(
        name="k5-lite-t2v-10s-sd",
        checkpoint_path="./weights/model/kandinsky5lite_t2v_sft_10s.safetensors",
        num_steps=50,
        guidance_weight=5.0,
        resolution=512,
        scale_factor=[1.0, 2.0, 2.0],
        dit_params=DiTParams(
            in_visual_dim=16,
            out_visual_dim=16,
            in_text_dim=3584,
            in_text_dim2=768,
            time_dim=512,
            patch_size=(1, 2, 2),
            model_dim=1792,
            ff_dim=7168,
            num_text_blocks=2,
            num_visual_blocks=32,
            axes_dims=(16, 24, 24),
            visual_cond=True,
        ),
        attention=AttentionConfig(
            type="nabla",
            chunk=False,
            causal=False,
            local=False,
            glob=False,
            window=3,
            method="topcdf",
            P=0.9,
            add_sta=True,
            wT=11,
            wH=3,
            wW=3,
        ),
        vae=_vae_hunyuan(),
        text=_text_default(),
        scheduler_scale=10.0,
        magcache=[
            0.92261,
            0.92261,
            0.95898,
            0.95962,
            1.04862,
            1.04855,
            1.0806,
            1.08045,
            1.04405,
            1.0445,
            1.03587,
            1.03619,
            1.03789,
            1.03785,
            1.03485,
            1.03514,
            1.03724,
            1.03814,
            1.02484,
            1.02502,
            1.02525,
            1.02508,
            1.02473,
            1.02532,
            1.02625,
            1.02706,
            1.0197,
            1.02011,
            1.02326,
            1.02324,
            1.02081,
            1.02116,
            1.01993,
            1.02047,
            1.01979,
            1.0205,
            1.01823,
            1.01852,
            1.01785,
            1.01813,
            1.01563,
            1.01606,
            1.02057,
            1.02083,
            1.01132,
            1.01207,
            1.02053,
            1.01959,
            1.01718,
            1.01749,
            1.01546,
            1.01589,
            1.01516,
            1.01525,
            1.01578,
            1.01608,
            1.01616,
            1.01618,
            1.01443,
            1.01466,
            1.01554,
            1.01568,
            1.01494,
            1.01515,
            1.01567,
            1.01572,
            1.01418,
            1.01458,
            1.01601,
            1.01618,
            1.01491,
            1.01508,
            1.0162,
            1.01625,
            1.01412,
            1.01419,
            1.01431,
            1.01437,
            1.0106,
            1.0108,
            1.01428,
            1.01427,
            1.01222,
            1.01236,
            1.00812,
            1.00818,
            1.00759,
            1.00764,
            1.001,
            1.00119,
            0.98798,
            0.98819,
            0.9727,
            0.97279,
            0.93234,
            0.93213,
            0.83781,
            0.83746,
        ],
    ),
    "k5-lite-i2v-5s-sd": TaskConfig(
        name="k5-lite-i2v-5s-sd",
        checkpoint_path="./weights/model/kandinsky5lite_i2v_5s.safetensors",
        num_steps=50,
        guidance_weight=5.0,
        resolution=512,
        scale_factor=[1.0, 2.0, 2.0],
        dit_params=DiTParams(
            in_visual_dim=16,
            out_visual_dim=16,
            in_text_dim=3584,
            in_text_dim2=768,
            time_dim=512,
            patch_size=(1, 2, 2),
            model_dim=1792,
            ff_dim=7168,
            num_text_blocks=2,
            num_visual_blocks=32,
            axes_dims=(16, 24, 24),
            visual_cond=True,
        ),
        attention=AttentionConfig(type="flash", chunk=False, causal=False, local=False, glob=False, window=3),
        vae=_vae_hunyuan(),
        text=_text_default(),
        scheduler_scale=10.0,
        magcache=[
            0.90524,
            0.89864,
            0.95225,
            0.95382,
            1.04828,
            1.04658,
            1.07989,
            1.07921,
            1.04345,
            1.04345,
            1.03547,
            1.03589,
            1.03715,
            1.03745,
            1.02909,
            1.02907,
            1.03391,
            1.03416,
            1.02366,
            1.02392,
            1.02359,
            1.02415,
            1.02256,
            1.02289,
            1.02447,
            1.02502,
            1.01824,
            1.01857,
            1.02236,
            1.02261,
            1.01704,
            1.01736,
            1.01838,
            1.01857,
            1.01886,
            1.01961,
            1.01619,
            1.0169,
            1.01655,
            1.01702,
            1.01477,
            1.01545,
            1.01926,
            1.01981,
            1.01145,
            1.01227,
            1.01276,
            1.01308,
            1.01583,
            1.01619,
            1.01587,
            1.01641,
            1.01386,
            1.01418,
            1.01441,
            1.01505,
            1.01473,
            1.01491,
            1.01346,
            1.01407,
            1.01319,
            1.0137,
            1.01283,
            1.01313,
            1.01412,
            1.01407,
            1.01222,
            1.0127,
            1.0131,
            1.01315,
            1.01398,
            1.0143,
            1.01483,
            1.01498,
            1.01158,
            1.01176,
            1.01342,
            1.01365,
            1.00893,
            1.0095,
            1.01223,
            1.01237,
            1.01005,
            1.01045,
            1.00694,
            1.00679,
            1.00691,
            1.00742,
            0.99846,
            0.99916,
            0.98563,
            0.98549,
            0.97116,
            0.97145,
            0.93116,
            0.93069,
            0.83437,
            0.83375,
        ],
    ),
    # Pro video models (19B)
    "k5-pro-t2v-5s-sd": TaskConfig(
        name="k5-pro-t2v-5s-sd",
        checkpoint_path="./weights/model/kandinsky5pro_t2v_sft_5s.safetensors",
        num_steps=50,
        guidance_weight=5.0,
        resolution=512,
        scale_factor=[1.0, 2.0, 2.0],
        dit_params=DiTParams(
            in_visual_dim=16,
            out_visual_dim=16,
            in_text_dim=3584,
            in_text_dim2=768,
            time_dim=1024,
            patch_size=(1, 2, 2),
            model_dim=4096,
            ff_dim=16384,
            num_text_blocks=4,
            num_visual_blocks=60,
            axes_dims=(32, 48, 48),
            visual_cond=True,
        ),
        attention=AttentionConfig(type="flash", chunk=False, causal=False, local=False, glob=False, window=3),
        vae=_vae_hunyuan(),
        text=_text_default(),
        scheduler_scale=10.0,
        magcache=[
            1.05108,
            1.05459,
            1.03217,
            1.02625,
            1.02084,
            1.01846,
            1.03457,
            1.03179,
            1.00932,
            1.00985,
            0.99931,
            0.9993,
            1.02284,
            1.01996,
            0.98916,
            0.99098,
            1.03845,
            1.03547,
            1.00028,
            1.0004,
            0.98184,
            0.98364,
            1.02553,
            1.02362,
            0.99988,
            0.99932,
            1.01271,
            1.01285,
            1.00014,
            1.00077,
            0.99271,
            0.99318,
            1.11646,
            1.11503,
            0.93333,
            0.93057,
            0.98949,
            0.99107,
            1.00834,
            1.00772,
            1.00786,
            1.00798,
            1.00357,
            1.00307,
            1.02427,
            1.02217,
            0.99526,
            0.99595,
            0.98479,
            0.98713,
            1.04114,
            1.02792,
            1.00598,
            1.00493,
            0.99466,
            0.99516,
            0.99617,
            0.99626,
            0.99749,
            0.99835,
            1.01384,
            1.01141,
            1.00413,
            1.00386,
            1.00521,
            1.00832,
            0.99833,
            0.99848,
            0.99242,
            0.99254,
            1.00186,
            1.00105,
            1.00468,
            1.00341,
            0.98685,
            0.98733,
            1.00656,
            1.00466,
            0.98858,
            0.98928,
            1.01212,
            1.00985,
            0.98267,
            0.98204,
            0.99826,
            0.99613,
            0.96953,
            0.96927,
            0.98073,
            0.97957,
            0.95653,
            0.95842,
            0.94036,
            0.93953,
            0.89943,
            0.89771,
            0.8026,
            0.80511,
        ],
    ),
    "k5-pro-t2v-5s-hd": TaskConfig(
        name="k5-pro-t2v-5s-hd",
        checkpoint_path="./weights/model/kandinsky5pro_t2v_sft_5s.safetensors",
        num_steps=50,
        guidance_weight=5.0,
        resolution=1024,
        scale_factor=[1.0, 3.16, 3.16],
        dit_params=DiTParams(
            in_visual_dim=16,
            out_visual_dim=16,
            in_text_dim=3584,
            in_text_dim2=768,
            time_dim=1024,
            patch_size=(1, 2, 2),
            model_dim=4096,
            ff_dim=16384,
            num_text_blocks=4,
            num_visual_blocks=60,
            axes_dims=(32, 48, 48),
            visual_cond=True,
        ),
        attention=AttentionConfig(
            type="nabla",
            chunk=False,
            causal=False,
            local=False,
            glob=False,
            window=3,
            method="topcdf",
            P=0.8,
            add_sta=True,
            wT=11,
            wH=3,
            wW=3,
        ),
        vae=_vae_hunyuan(),
        text=_text_default(),
        scheduler_scale=10.0,
        magcache=[
            1.06133,
            1.06278,
            1.03873,
            1.03381,
            1.02178,
            1.0193,
            1.03491,
            1.03217,
            1.00996,
            1.0107,
            1.00116,
            1.00166,
            1.02416,
            1.02113,
            0.99041,
            0.9923,
            1.03965,
            1.03658,
            1.00088,
            1.00101,
            0.98248,
            0.98433,
            1.02611,
            1.0244,
            1.00062,
            0.99987,
            1.01328,
            1.01354,
            1.00058,
            1.00124,
            0.99323,
            0.99369,
            1.11828,
            1.11693,
            0.93251,
            0.92965,
            0.9899,
            0.99161,
            1.00862,
            1.00802,
            1.00781,
            1.00803,
            1.00378,
            1.003,
            1.02443,
            1.02223,
            0.99546,
            0.99611,
            0.98498,
            0.98758,
            1.04163,
            1.02739,
            1.00603,
            1.00499,
            0.99486,
            0.99531,
            0.99648,
            0.99687,
            0.99773,
            0.99845,
            1.01416,
            1.01168,
            1.00427,
            1.00404,
            1.00567,
            1.00861,
            0.99845,
            0.99858,
            0.99266,
            0.99283,
            1.00193,
            1.00096,
            1.00457,
            1.00317,
            0.98699,
            0.98747,
            1.00696,
            1.00524,
            0.98907,
            0.98964,
            1.01238,
            1.00992,
            0.98305,
            0.98243,
            0.99844,
            0.99614,
            0.96994,
            0.96961,
            0.98165,
            0.98019,
            0.95794,
            0.95881,
            0.94205,
            0.94027,
            0.90171,
            0.89945,
            0.80597,
            0.80726,
        ],
    ),
    "k5-pro-t2v-10s-sd": TaskConfig(
        name="k5-pro-t2v-10s-sd",
        checkpoint_path="./weights/model/kandinsky5pro_t2v_sft_10s.safetensors",
        num_steps=50,
        guidance_weight=5.0,
        resolution=512,
        scale_factor=[1.0, 2.0, 2.0],
        dit_params=DiTParams(
            in_visual_dim=16,
            out_visual_dim=16,
            in_text_dim=3584,
            in_text_dim2=768,
            time_dim=1024,
            patch_size=(1, 2, 2),
            model_dim=4096,
            ff_dim=16384,
            num_text_blocks=4,
            num_visual_blocks=60,
            axes_dims=(32, 48, 48),
            visual_cond=True,
        ),
        attention=AttentionConfig(
            type="nabla",
            chunk=False,
            causal=False,
            local=False,
            glob=False,
            window=3,
            method="topcdf",
            P=0.9,
            add_sta=True,
            wT=11,
            wH=3,
            wW=3,
        ),
        vae=_vae_hunyuan(),
        text=_text_default(),
        scheduler_scale=10.0,
        magcache=[
            0.98023,
            0.99247,
            1.03089,
            1.02514,
            1.01309,
            1.01089,
            1.03909,
            1.03481,
            1.01614,
            1.01475,
            0.99935,
            0.99898,
            1.02636,
            1.02427,
            1.01073,
            1.00992,
            1.01095,
            1.01107,
            0.99695,
            0.99739,
            0.99787,
            0.99773,
            1.02732,
            1.02448,
            0.99997,
            1.00002,
            1.00324,
            1.00319,
            1.01161,
            1.01049,
            0.98849,
            0.99007,
            1.10221,
            1.10528,
            0.94084,
            0.93506,
            0.99063,
            0.9922,
            1.00556,
            1.00493,
            1.01289,
            1.01203,
            0.99886,
            0.99879,
            1.01212,
            1.01146,
            1.01083,
            1.00942,
            0.98618,
            0.98824,
            1.04545,
            1.03401,
            0.9971,
            0.99662,
            1.00007,
            0.99974,
            0.9939,
            0.99448,
            1.00796,
            1.00782,
            1.00393,
            1.00306,
            1.00658,
            1.00564,
            1.01497,
            1.01626,
            0.98722,
            0.99015,
            0.99306,
            0.99243,
            1.00389,
            1.00315,
            0.99839,
            0.99737,
            0.98623,
            0.987,
            1.00564,
            1.00449,
            0.99039,
            0.99077,
            1.01105,
            1.00893,
            0.98778,
            0.98706,
            0.98957,
            0.98776,
            0.96636,
            0.96637,
            0.98293,
            0.98142,
            0.94226,
            0.9443,
            0.94195,
            0.94136,
            0.90399,
            0.902,
            0.82158,
            0.82574,
        ],
    ),
    "k5-pro-t2v-10s-hd": TaskConfig(
        name="k5-pro-t2v-10s-hd",
        checkpoint_path="./weights/model/kandinsky5pro_t2v_sft_10s.safetensors",
        num_steps=50,
        guidance_weight=5.0,
        resolution=1024,
        scale_factor=[1.0, 3.16, 3.16],
        dit_params=DiTParams(
            in_visual_dim=16,
            out_visual_dim=16,
            in_text_dim=3584,
            in_text_dim2=768,
            time_dim=1024,
            patch_size=(1, 2, 2),
            model_dim=4096,
            ff_dim=16384,
            num_text_blocks=4,
            num_visual_blocks=60,
            axes_dims=(32, 48, 48),
            visual_cond=True,
        ),
        attention=AttentionConfig(
            type="nabla",
            chunk=False,
            causal=False,
            local=False,
            glob=False,
            window=3,
            method="topcdf",
            P=0.7,
            add_sta=True,
            wT=11,
            wH=3,
            wW=3,
        ),
        vae=_vae_hunyuan(),
        text=_text_default(),
        scheduler_scale=10.0,
        magcache=[
            0.98274,
            0.99493,
            1.03168,
            1.02614,
            1.01401,
            1.01221,
            1.03825,
            1.03402,
            1.01536,
            1.01369,
            0.99859,
            0.99838,
            1.0256,
            1.02299,
            1.01021,
            1.00946,
            1.01049,
            1.01061,
            0.99666,
            0.99734,
            0.99738,
            0.99721,
            1.02686,
            1.02436,
            0.99975,
            1.00001,
            1.00307,
            1.00302,
            1.0112,
            1.01022,
            0.98854,
            0.99003,
            1.10228,
            1.10421,
            0.94015,
            0.93541,
            0.99062,
            0.99209,
            1.00531,
            1.00466,
            1.0125,
            1.01194,
            0.99846,
            0.99835,
            1.01178,
            1.01121,
            1.0105,
            1.00914,
            0.98608,
            0.988,
            1.04434,
            1.03336,
            0.99672,
            0.99642,
            0.99961,
            0.99924,
            0.99378,
            0.99426,
            1.00752,
            1.00722,
            1.00349,
            1.00256,
            1.00613,
            1.00526,
            1.01463,
            1.01604,
            0.98702,
            0.98944,
            0.99258,
            0.99203,
            1.00309,
            1.00248,
            0.99763,
            0.99656,
            0.98566,
            0.98628,
            1.00527,
            1.00374,
            0.98961,
            0.98984,
            1.00967,
            1.00762,
            0.98694,
            0.9865,
            0.98838,
            0.9866,
            0.96498,
            0.9649,
            0.98126,
            0.98001,
            0.94053,
            0.94297,
            0.94064,
            0.93973,
            0.90176,
            0.89994,
            0.82025,
            0.82369,
        ],
    ),
    "k5-pro-i2v-5s-sd": TaskConfig(
        name="k5-pro-i2v-5s-sd",
        checkpoint_path="./weights/model/kandinsky5pro_i2v_sft_5s.safetensors",
        num_steps=50,
        guidance_weight=5.0,
        resolution=512,
        scale_factor=[1.0, 2.0, 2.0],
        dit_params=DiTParams(
            in_visual_dim=16,
            out_visual_dim=16,
            in_text_dim=3584,
            in_text_dim2=768,
            time_dim=1024,
            patch_size=(1, 2, 2),
            model_dim=4096,
            ff_dim=16384,
            num_text_blocks=4,
            num_visual_blocks=60,
            axes_dims=(32, 48, 48),
            visual_cond=True,
        ),
        attention=AttentionConfig(type="flash", chunk=False, causal=False, local=False, glob=False, window=3),
        vae=_vae_hunyuan(),
        text=_text_default(),
        scheduler_scale=10.0,
        magcache=[
            0.95295,
            0.96037,
            1.11843,
            1.10903,
            1.01421,
            1.01204,
            1.01811,
            1.01562,
            1.01231,
            1.01056,
            0.9972,
            0.99662,
            1.01979,
            1.01757,
            1.02381,
            1.02207,
            0.99479,
            0.9951,
            1.00294,
            1.0024,
            0.99773,
            0.9984,
            1.01817,
            1.01605,
            0.99913,
            0.99944,
            0.99218,
            0.99299,
            1.03239,
            1.03021,
            0.99568,
            0.9951,
            1.0124,
            1.01201,
            0.97933,
            0.98116,
            1.02511,
            1.02369,
            0.98456,
            0.98444,
            1.01573,
            1.01525,
            1.01743,
            1.01688,
            0.99326,
            0.99416,
            0.99642,
            0.99641,
            1.03137,
            1.0265,
            1.00513,
            1.00922,
            0.97789,
            0.98044,
            1.02419,
            1.02194,
            1.00083,
            1.00147,
            0.99584,
            0.9971,
            1.01021,
            1.00855,
            1.03171,
            1.02869,
            0.97483,
            0.97822,
            1.03725,
            1.02688,
            1.00433,
            1.00196,
            0.99005,
            0.99085,
            1.01196,
            1.01015,
            0.99815,
            1.00002,
            1.00673,
            1.00522,
            1.00589,
            1.00883,
            1.00424,
            1.00184,
            0.9863,
            0.98711,
            1.00569,
            1.00432,
            0.99096,
            0.98978,
            1.00107,
            0.99868,
            0.97743,
            0.97855,
            0.96446,
            0.96312,
            0.93896,
            0.9413,
            0.85115,
            0.84801,
        ],
    ),
    "k5-pro-i2v-5s-hd": TaskConfig(
        name="k5-pro-i2v-5s-hd",
        checkpoint_path="./weights/model/kandinsky5pro_i2v_sft_5s.safetensors",
        num_steps=50,
        guidance_weight=5.0,
        resolution=1024,
        scale_factor=[1.0, 3.16, 3.16],
        dit_params=DiTParams(
            in_visual_dim=16,
            out_visual_dim=16,
            in_text_dim=3584,
            in_text_dim2=768,
            time_dim=1024,
            patch_size=(1, 2, 2),
            model_dim=4096,
            ff_dim=16384,
            num_text_blocks=4,
            num_visual_blocks=60,
            axes_dims=(32, 48, 48),
            visual_cond=True,
        ),
        attention=AttentionConfig(
            type="nabla",
            chunk=False,
            causal=False,
            local=False,
            glob=False,
            window=3,
            method="topcdf",
            P=0.8,
            add_sta=True,
            wT=11,
            wH=3,
            wW=3,
        ),
        vae=_vae_hunyuan(),
        text=_text_default(),
        scheduler_scale=5.0,
        magcache=[
            1.03563,
            1.03368,
            1.04423,
            1.03794,
            1.00481,
            1.00407,
            1.0317,
            1.02925,
            1.03814,
            1.03604,
            0.99118,
            0.99214,
            1.00768,
            1.00728,
            0.9999,
            1.00075,
            1.03272,
            1.03035,
            1.01254,
            1.01205,
            0.9801,
            0.98287,
            1.02185,
            1.02018,
            0.99365,
            0.99368,
            1.00572,
            1.00619,
            1.01411,
            1.01344,
            1.00445,
            1.00438,
            1.11448,
            1.11342,
            0.94186,
            0.94065,
            0.99309,
            0.99454,
            1.0088,
            1.00838,
            1.00741,
            1.00808,
            1.00698,
            1.00605,
            1.01266,
            1.01218,
            1.0106,
            1.00968,
            0.98969,
            0.99204,
            1.01784,
            1.00727,
            1.00304,
            1.0025,
            1.00326,
            1.00309,
            0.99478,
            0.99558,
            1.00362,
            1.00373,
            1.00801,
            1.00714,
            1.00184,
            1.00202,
            1.0099,
            1.01111,
            0.99854,
            0.99918,
            0.99393,
            0.99442,
            1.00183,
            1.00176,
            1.00648,
            1.00565,
            0.98875,
            0.98903,
            1.00561,
            1.00376,
            0.99138,
            0.9926,
            1.01195,
            1.01037,
            0.97298,
            0.97494,
            0.99551,
            0.99309,
            0.96925,
            0.96974,
            0.9741,
            0.97415,
            0.95861,
            0.96225,
            0.94539,
            0.94383,
            0.89835,
            0.89666,
            0.81038,
            0.81322,
        ],
    ),
    # Lite distilled models (16 steps)
    "k5-lite-t2v-5s-distil-sd": TaskConfig(
        name="k5-lite-t2v-5s-distil-sd",
        checkpoint_path="./weights/model/kandinsky5lite_t2v_distilled16steps_5s.safetensors",
        num_steps=16,
        guidance_weight=1.0,
        resolution=512,
        scale_factor=[1.0, 2.0, 2.0],
        dit_params=DiTParams(
            in_visual_dim=16,
            out_visual_dim=16,
            in_text_dim=3584,
            in_text_dim2=768,
            time_dim=512,
            patch_size=(1, 2, 2),
            model_dim=1792,
            ff_dim=7168,
            num_text_blocks=2,
            num_visual_blocks=32,
            axes_dims=(16, 24, 24),
            visual_cond=True,
        ),
        attention=AttentionConfig(type="flash", chunk=False, causal=False, local=False, glob=False, window=3),
        vae=_vae_hunyuan(),
        text=_text_default(),
        scheduler_scale=5.0,
    ),
    "k5-lite-t2v-10s-distil-sd": TaskConfig(
        name="k5-lite-t2v-10s-distil-sd",
        checkpoint_path="./weights/model/kandinsky5lite_t2v_distilled16steps_10s.safetensors",
        num_steps=16,
        guidance_weight=1.0,
        resolution=512,
        scale_factor=[1.0, 2.0, 2.0],
        dit_params=DiTParams(
            in_visual_dim=16,
            out_visual_dim=16,
            in_text_dim=3584,
            in_text_dim2=768,
            time_dim=512,
            patch_size=(1, 2, 2),
            model_dim=1792,
            ff_dim=7168,
            num_text_blocks=2,
            num_visual_blocks=32,
            axes_dims=(16, 24, 24),
            visual_cond=True,
        ),
        attention=AttentionConfig(
            type="nabla",
            chunk=False,
            causal=False,
            local=False,
            glob=False,
            window=3,
            method="topcdf",
            P=0.9,
            add_sta=True,
            wT=11,
            wH=3,
            wW=3,
        ),
        vae=_vae_hunyuan(),
        text=_text_default(),
        scheduler_scale=10.0,
    ),
    # Lite no-CFG models (guidance_weight=1.0)
    "k5-lite-t2v-5s-nocfg-sd": TaskConfig(
        name="k5-lite-t2v-5s-nocfg-sd",
        checkpoint_path="./weights/model/kandinsky5lite_t2v_nocfg_5s.safetensors",
        num_steps=50,
        guidance_weight=1.0,
        resolution=512,
        scale_factor=[1.0, 2.0, 2.0],
        dit_params=DiTParams(
            in_visual_dim=16,
            out_visual_dim=16,
            in_text_dim=3584,
            in_text_dim2=768,
            time_dim=512,
            patch_size=(1, 2, 2),
            model_dim=1792,
            ff_dim=7168,
            num_text_blocks=2,
            num_visual_blocks=32,
            axes_dims=(16, 24, 24),
            visual_cond=True,
        ),
        attention=AttentionConfig(type="flash", chunk=False, causal=False, local=False, glob=False, window=3),
        vae=_vae_hunyuan(),
        text=_text_default(),
        scheduler_scale=10.0,
        magcache=[
            0.8827,
            0,
            1.14399,
            0,
            1.08362,
            0,
            1.06681,
            0,
            1.05906,
            0,
            1.03969,
            0,
            1.03835,
            0,
            1.03338,
            0,
            1.031,
            0,
            1.02616,
            0,
            1.02654,
            0,
            1.02322,
            0,
            1.02078,
            0,
            1.02,
            0,
            1.01673,
            0,
            1.01353,
            0,
            1.02175,
            0,
            1.0156,
            0,
            1.01616,
            0,
            1.01557,
            0,
            1.0131,
            0,
            1.01264,
            0,
            1.01378,
            0,
            1.0147,
            0,
            1.0109,
            0,
            1.01178,
            0,
            1.01248,
            0,
            1.0111,
            0,
            1.0099,
            0,
            1.01248,
            0,
            1.00721,
            0,
            1.01134,
            0,
            1.00752,
            0,
            1.00837,
            0,
            1.00817,
            0,
            1.00475,
            0,
            0.99937,
            0,
            1.01171,
            0,
            1.00434,
            0,
            0.99868,
            0,
            0.9969,
            0,
            0.995,
            0,
            0.98869,
            0,
            0.98454,
            0,
            0.97462,
            0,
            0.95885,
            0,
            0.93354,
            0,
            0.88895,
            0,
            0.78835,
            0,
        ],
    ),
    "k5-lite-t2v-10s-nocfg-sd": TaskConfig(
        name="k5-lite-t2v-10s-nocfg-sd",
        checkpoint_path="./weights/model/kandinsky5lite_t2v_sft_10s.safetensors",
        num_steps=50,
        guidance_weight=1.0,
        resolution=512,
        scale_factor=[1.0, 2.0, 2.0],
        dit_params=DiTParams(
            in_visual_dim=16,
            out_visual_dim=16,
            in_text_dim=3584,
            in_text_dim2=768,
            time_dim=512,
            patch_size=(1, 2, 2),
            model_dim=1792,
            ff_dim=7168,
            num_text_blocks=2,
            num_visual_blocks=32,
            axes_dims=(16, 24, 24),
            visual_cond=True,
        ),
        attention=AttentionConfig(
            type="nabla",
            chunk=False,
            causal=False,
            local=False,
            glob=False,
            window=3,
            method="topcdf",
            P=0.9,
            add_sta=True,
            wT=11,
            wH=3,
            wW=3,
        ),
        vae=_vae_hunyuan(),
        text=_text_default(),
        scheduler_scale=10.0,
        magcache=[
            0.8736,
            0,
            1.12136,
            0,
            1.07896,
            0,
            1.06666,
            0,
            1.06235,
            0,
            1.03925,
            0,
            1.04018,
            0,
            1.0355,
            0,
            1.0327,
            0,
            1.02839,
            0,
            1.02768,
            0,
            1.02488,
            0,
            1.02143,
            0,
            1.02133,
            0,
            1.01715,
            0,
            1.01943,
            0,
            1.02177,
            0,
            1.01829,
            0,
            1.01747,
            0,
            1.01626,
            0,
            1.01559,
            0,
            1.01435,
            0,
            1.01435,
            0,
            1.01571,
            0,
            1.01312,
            0,
            1.01338,
            0,
            1.01437,
            0,
            1.01211,
            0,
            1.01237,
            0,
            1.01356,
            0,
            1.0101,
            0,
            1.01194,
            0,
            1.00898,
            0,
            1.0091,
            0,
            1.0108,
            0,
            1.00705,
            0,
            1.0018,
            0,
            1.01209,
            0,
            1.00525,
            0,
            1.00098,
            0,
            0.99914,
            0,
            0.99592,
            0,
            0.99089,
            0,
            0.98506,
            0,
            0.97495,
            0,
            0.9604,
            0,
            0.93492,
            0,
            0.89367,
            0,
            0.79353,
            0,
        ],
    ),
    # Lite pretrain models
    "k5-lite-t2v-5s-pretrain-sd": TaskConfig(
        name="k5-lite-t2v-5s-pretrain-sd",
        checkpoint_path="./weights/model/kandinsky5lite_t2v_pretrain_5s.safetensors",
        num_steps=50,
        guidance_weight=5.0,
        resolution=512,
        scale_factor=[1.0, 2.0, 2.0],
        dit_params=DiTParams(
            in_visual_dim=16,
            out_visual_dim=16,
            in_text_dim=3584,
            in_text_dim2=768,
            time_dim=512,
            patch_size=(1, 2, 2),
            model_dim=1792,
            ff_dim=7168,
            num_text_blocks=2,
            num_visual_blocks=32,
            axes_dims=(16, 24, 24),
            visual_cond=True,
        ),
        attention=AttentionConfig(type="flash", chunk=False, causal=False, local=False, glob=False, window=3),
        vae=_vae_hunyuan(),
        text=_text_default(),
        scheduler_scale=10.0,
    ),
    "k5-lite-t2v-10s-pretrain-sd": TaskConfig(
        name="k5-lite-t2v-10s-pretrain-sd",
        checkpoint_path="./weights/model/kandinsky5lite_t2v_pretrain_10s.safetensors",
        num_steps=50,
        guidance_weight=5.0,
        resolution=512,
        scale_factor=[1.0, 2.0, 2.0],
        dit_params=DiTParams(
            in_visual_dim=16,
            out_visual_dim=16,
            in_text_dim=3584,
            in_text_dim2=768,
            time_dim=512,
            patch_size=(1, 2, 2),
            model_dim=1792,
            ff_dim=7168,
            num_text_blocks=2,
            num_visual_blocks=32,
            axes_dims=(16, 24, 24),
            visual_cond=True,
        ),
        attention=AttentionConfig(
            type="nabla",
            chunk=False,
            causal=False,
            local=False,
            glob=False,
            window=3,
            method="topcdf",
            P=0.9,
            add_sta=True,
            wT=11,
            wH=3,
            wW=3,
        ),
        vae=_vae_hunyuan(),
        text=_text_default(),
        scheduler_scale=10.0,
    ),
}
